<!DOCTYPE html>
<html>

<head>
  <script src="bower_components/webcomponentsjs/webcomponents-lite.js">
  </script>
  <link rel="import" href="bower_components/polymer/polymer.html">
  <link rel="import" href="bower_components/iron-ajax/iron-ajax.html">
  <title>Blogger Label List Element</title>
</head>

<body>
  <dom-module id="blogger-list">
    <template>
      <iron-ajax auto url="{{url}}" handle-as="json" last-response="{{ajaxResponse}}"></iron-ajax>
      <ul>
        <template is="dom-repeat" items="[[ajaxResponse.items]]">
          <li><a href="{{item.url}}">{{item.title}}</li>
        </template>
      </ul>
    </template>
    <script>
        Polymer({
          is: 'blogger-list',
          properties: {
            labels: String,
            blogId: String,
            apiKey: String
          },
          attached: function() {
            if(this.labels){
              this.url = this._getPostsByLabelUrl();
            }else{
              this.url = this._getPostsUrl();
            }
          },
          _bloggerUrl: function(path, params){
            var url = "https://www.googleapis.com/blogger/v3/blogs/" +this.blogId + path + "?maxResults=50&fields=items(title,url)&key=" +this.apiKey;
            if(params){
              for(var i in params){
                url += "&" + i + "=" + params[i];
              }
            }
            return url;
          },
          _getPostsUrl: function(){
            return this._bloggerUrl("/posts");
          },
          _getPostsByLabelUrl: function(){
            var labelsQuery = "label:" + this.labels.split(",").join("|label:");
            return this._bloggerUrl("/posts/search",{
              q: labelsQuery
            });
          }
        });
    </script>
  </dom-module>

<p> My ukulele posts</p>
    <blogger-list labels="ukulele" blog-id="6321600142310040063" api-key="AIzaSyCK9jp0SSsD6CXPWAY2Z_XvaVZdrhoR4LU"></blogger-list>

<p>My GIS posts</p>
  <blogger-list labels="GIS" blog-id="6321600142310040063" api-key="AIzaSyCK9jp0SSsD6CXPWAY2Z_XvaVZdrhoR4LU"></blogger-list>

<p>My music posts</p>
  <blogger-list labels="music" blog-id="6321600142310040063" api-key="AIzaSyCK9jp0SSsD6CXPWAY2Z_XvaVZdrhoR4LU"></blogger-list>

  <p>My music and GIS posts</p>
    <blogger-list labels="music,GIS" blog-id="6321600142310040063" api-key="AIzaSyCK9jp0SSsD6CXPWAY2Z_XvaVZdrhoR4LU"></blogger-list>

<p>All of my posts</p>
  <blogger-list blog-id="6321600142310040063" api-key="AIzaSyCK9jp0SSsD6CXPWAY2Z_XvaVZdrhoR4LU"></blogger-list>

</body>

</html>
